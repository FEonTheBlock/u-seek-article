# Git의 동작원리

## 데이터베이스
- Key-Value Storage
- 입력값(파일내용)이 조금이라도 달라지면 달라지는 해시를 통해 변경 여부를 파악
  - 같은 내용의 파일이라면 같은 해시값으로 저장되므로 중복되는 데이터를 효율적으로 저장
- git DB에 저장되는 objects는 크게 세 가지
  - blob: 파일의 내용을 담고 있는 객체
  - tree: 파일의 이름과 경로를 담은, 디렉터리를 저장하는 객체
  - commit: 프로젝트의 루트 트리의 해시값, 부모 commit의 해시값 그리고 메타데이터를 저장하는 객체
- insert와 select만 되고, update나 delete는 허용하지 않는다. 
  - 한 번 저장되면 영원히 남아있다. 
- 경제적으로 관리된다. 프로젝트 스냅샷 전체가 하나의 해시값으로 나온다.

## 커밋
- 커밋은 프로젝트의 루트 트리의 해시값, 부모 커밋의 해시값, 그리고 메타데이터로 이루어져 있다.
  - 프로젝트 루트 트리: 프로젝트 스냅샷
  - 부모 커밋: 이 커밋이 이루어진 기반이 되는 커밋, 최초 커밋은 부모 커밋이 null
  - 메타데이터: 커밋 메시지, author 정보, 날짜, 시간 등
- 파일을 추가한 첫 커밋을 만들면 일어나는 일
  - 파일 저장: 파일 내용을 해싱하고 압축하여 해시값은 key, 내용은 value로 DB에 저장
  - 트리 저장: 해당 파일의 이름과 내용을 연결한 객체를 해싱하여 해시값은 key, 내용은 value로 DB에 저장, 폴더구조라면 폴더 및 루트의 해시값도 만들어 저장
  - 커밋 저장: 커밋 메시지와 author, parent 커밋, 루트 해시값 정보를 담은 객체를 해싱하여 해시값은 key, 내용은 value로 DB에 저장
- 위 커밋에서 파일 내용을 바꾼 새로운 파일 스냅샷을 커밋하면 일어나는 일
  - 파일 내용이 바뀌면서 해시값이 달라지므로, 새로운 파일 내용을 해싱하고 압축하여 해시값은 key, 내용은 value로 DB에 저장
  - 바뀌지 않은 파일들은 해싱하더라도 해시값이 동일하므로 원래 있던 해시값을 key로 갖는다.
  - 바뀐 파일이 포함된 폴더(루트노드)는 구성파일에 연결된 해시값이 달라지므로 새로운 해시값을 갖는다.
  - 새로운 커밋이 갖는 루트 노드 해시값과 메타데이터, 커밋 메시지를 담은 객체를 해싱하여 저장한다. 여기서 parent 커밋은 위 커밋의 커밋 해시값이다.

## 레퍼런스: tag와 branch
- 특정 커밋의 해시값을 기억해서 해당 파일상태를 모두 불러올 수 있다. 
  - branch: 새로운 커밋을 하면 그 커밋을 바라보도록 바뀐다.
  - tag: 새로 커밋하더라도 원래 태그했던 커밋에 붙어있는다(일부러 삭제하고 새 커밋에 달지 않는 이상)
- .git 디렉토리 안의 reference 파일들 
  - `refs/heads`라는 디렉토리 브랜치 이름을 파일명으로 하여 해당 브랜치의 tip 커밋해시를 저장
  - `refs/tags`라는 디렉토리도 태그 이름을 파일명으로 하며, 태그가 바라보는 커밋해시를 저장
- 브랜치가 여러 개인 경우 내가 작업하는 브랜치를 저장하는 것이 `.git/HEAD`


## Merge, Rebase, Cherry-pick, Revert 등은 다음 시간에...

## 참고자료
- [소프트웨어 개발의 지혜 <Git 편>](https://www.codesoom.com/courses/git)